<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fold server</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="src/styles.css">
</head>
    <body>
    <div class="fill wave">
        <div class="grid-3">
            <div class="paper centered-column">
                <div id="terminal" class="deep width-80 wave-frame top-column h-full gap-0 hidden m-frame pb_3">
                    <div class="end-row">
                        <div id="terminalCloseBtn" class="pr_05 mr_05 pt_05 mt_05 btn btn-deep">
                            x
                        </div>
                    </div>
                    <div id="terminal-text" class="p_2 terminal-text mb_2 fill-x">

                    </div>
                </div>
            </div>
            <div class="centered-column wave g-6" >
                <form id="passwordLogin" class="m-frame width-80 start-column g-2">
                    <label for="username" class="label-text fill-x">Username</label>
                    <input id="username" class="input" name="username" type="text"  placeholder="Enter your username">
                    <label for="password" class="label-text fill-x ">Password</label>
                    <input id="password" class="input" name="password" type="password"  placeholder="Enter your password">
                    <div class="end-row pt_2">
                        <button type="submit" class="gsi-material-button fill-x">Login</button>
                    </div>
                </form>
                <form id="googleLogin" action="" method="post" class="width-80 centered-column pt_2">
                    <button type="submit" class="gsi-material-button width-80" id="googleLoginBth">
                        <div class="gsi-material-button-state"></div>
                        <div class="gsi-material-button-content-wrapper">
                            <div class="gsi-material-button-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: block;">
                                    <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                                    <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
                                    <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
                                    <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                                    <path fill="none" d="M0 0h48v48H0z"></path>
                                </svg>
                            </div>
                            <span class="gsi-material-button-contents">Sign in with Google</span>
                            <span style="display: none;">Sign in with Google</span>
                        </div>
                    </button>
                </form>
                <div id="loading" class="loader logo-size hidden"></div>
                <div id="me">
                    <span>Welcome, </span><span id="meText"></span>
                </div>
                <button id="logout" class="btn btn-wave">
                    Logout
                </button>
            </div>
            <div class="paper centered-column h-full gap-0 font-bold text-xl">
                <a href="/">
                    <svg id="logo" width="185" height="196" viewBox="0 0 185 196" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                                d="M91.1875 34C96.6458 34 101.854 34.5833 106.812 35.75C111.729 36.875 116.062 38.7083 119.812 41.25C123.521 43.75 126.479 47 128.688 51C130.896 54.9583 132 59.75 132 65.375V91.875H50.4375V65.375C50.4375 59.8333 51.5625 55.0833 53.8125 51.125C56.0208 47.125 58.9792 43.875 62.6875 41.375C66.3958 38.8333 70.7083 36.9792 75.625 35.8125C80.5417 34.6042 85.7292 34 91.1875 34ZM91.1875 46.9375C81.7708 46.9375 74.5833 48.5417 69.625 51.75C64.625 54.9583 62.125 59.5 62.125 65.375V78.9375H120.375V65.375C120.375 59.5 117.833 54.9583 112.75 51.75C107.667 48.5417 100.479 46.9375 91.1875 46.9375Z"
                                fill="#0C2D50"/>
                        <path
                                d="M105.75 176H157.875V94.4375H144.938V164.375H105.75V176Z" fill="#0C2D50"/>
                        <path
                                d="M91.1875 167C85.7292 167 80.4583 166.417 75.375 165.25C70.2917 164.083 65.8125 162.271 61.9375 159.812C58.0625 157.354 54.9583 154.146 52.625 150.188C50.25 146.188 49.0625 141.375 49.0625 135.75C49.0625 130.125 50.25 125.333 52.625 121.375C54.9583 117.375 58.0625 114.125 61.9375 111.625C65.8125 109.125 70.2917 107.312 75.375 106.188C80.4583 105.062 85.7292 104.5 91.1875 104.5C96.6458 104.5 101.917 105.062 107 106.188C112.042 107.312 116.542 109.104 120.5 111.562C124.417 114.021 127.562 117.25 129.938 121.25C132.271 125.208 133.438 130.042 133.438 135.75C133.438 141.458 132.271 146.312 129.938 150.312C127.562 154.271 124.417 157.5 120.5 160C116.542 162.458 112.042 164.229 107 165.312C101.917 166.438 96.6458 167 91.1875 167ZM91.1875 154.062C94.8542 154.062 98.5208 153.792 102.188 153.25C105.854 152.667 109.146 151.708 112.062 150.375C114.938 149 117.271 147.146 119.062 144.812C120.854 142.438 121.75 139.417 121.75 135.75C121.75 132.083 120.854 129.083 119.062 126.75C117.271 124.375 114.938 122.521 112.062 121.188C109.146 119.812 105.854 118.854 102.188 118.312C98.5208 117.729 94.8542 117.438 91.1875 117.438C87.5208 117.438 83.875 117.729 80.25 118.312C76.625 118.854 73.3542 119.812 70.4375 121.188C67.5208 122.521 65.1667 124.396 63.375 126.812C61.5833 129.188 60.6875 132.167 60.6875 135.75C60.6875 141.708 63.375 146.25 68.75 149.375C74.125 152.5 81.6042 154.062 91.1875 154.062Z"
                                fill="#0C2D50"/>
                        <path
                                d="M80.25 106.125H41.0625V128.625H71.625V140.312H41.0625V176H28.125V94.4375H80.25V106.125Z"
                                fill="#0C2D50"/>
                    </svg>
                </a>
                FOLD SERVER
            </div>

        </div>
    </div>
    </body>
    <script type="module">
        import { googleAuthLink, login, showSupportedAuthOptions } from './src/login.js';
        import { parseForm, hide, show } from "./src/util.js";
        import { listenForErrors, listenLoading, redirectToControl, listenForUser} from "./src/main.js";

        function loginWithPassword(event){
            const data = parseForm(event, { username: "string", password : "string"})
            login(data).then(redirectToControl)
            event.preventDefault();
        }

        window.onload = function () {
            document.getElementById('googleLogin').action = googleAuthLink();
            document.getElementById('passwordLogin').addEventListener('submit', loginWithPassword)
            const loading = document.getElementById("loading")
            const passwordForm = document.getElementById("passwordLogin")
            const googleButton = document.getElementById("googleLogin")
            const userInfo = document.getElementById("me")
            const userInfoText = document.getElementById("meText")
            const logoutBtn = document.getElementById("logout")
            const logo = document.getElementById("logo")
            const loginControls = showSupportedAuthOptions({
                password : [passwordForm],
                google : [googleButton]
            })
            listenLoading(window,
                ()=>{
                    hide(loginControls)
                    hide(logo)
                    show(loading)
                },()=>{
                    show(loginControls)
                    show(logo)
                    hide(loading)
                } )

            listenForUser(window, loginControls, [userInfo, logoutBtn], userInfoText, logoutBtn)

            const terminal = document.getElementById("terminal");
            const terminalText = document.getElementById("terminal-text");
            const terminalButton = document.getElementById("terminalCloseBtn")

            listenForErrors(window, [terminal], terminalText, terminalButton)
        }
    </script>
</html>